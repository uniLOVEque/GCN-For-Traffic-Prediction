

---

# GCN交通预测

> **导读：**
> 交通预测是智慧城市大脑建设的核心环节。近年来，图卷积网络（GCN）因其出色的时空建模能力，成为解决该问题的重要工具。本文系统分析四篇具有代表性的论文，从经典的 STGCN，到引入注意力机制的 ASTGCN，再到融合属性信息的 AST-GCN，以及提出通用融合框架的 STDF，全面梳理 GCN 在交通预测中的技术演化路径，助力研究者与开发者快速掌握当前主流模型设计理念与实践要点。

---

## 1. 问题定义与图卷积框架

在对比不同模型之前，我们先统一它们所基于的问题形式和基本图卷积操作。

### 问题抽象

* **路网建模：** 交通网络被建模为图 `G = (V, E, A)`，其中 `V` 表示包含 `N` 个节点（dataset决定）的集合，`A ∈ ℝ^{N×N}` 为邻接矩阵，刻画节点之间的空间连接关系。
* **输入张量：** 历史观测数据构成张量 `X ∈ ℝ^{B × T_in × N × C}`，其中 `B` 为批大小，`T_in` 为时间步数，`C` 为特征数（如速度、流量等）。
* **预测目标：** 输出为未来 `T_out` 个时间步的交通状态 `\hat{Y} ∈ ℝ^{B × T_out × N × C'}`。

### 核心模块：图卷积

主流模型多采用谱图卷积的一阶近似，其传播公式为：

![图卷积公式](https://latex.codecogs.com/png.image?\dpi{120}H^{\(l+1\)}%20=%20\sigma\left\(\hat{D}^{-1/2}%20\hat{A}%20\hat{D}^{-1/2}%20H^{\(l\)}%20W^{\(l\)}\right\))

其中 `\hat{A} = A + I` 为添加自环后的邻接矩阵，`\hat{D}` 为其度矩阵，`W^{(l)}` 是第 `l` 层的可学习权重。

---

## 2. STGCN (Yu et al., 2018)：奠定全卷积范式

**核心思想：** 用纯卷积网络替代传统的 RNN 架构，分离时空建模。

**结构设计：**

* **ST-Conv Block：** 采用“时间卷积 → 图卷积 → 时间卷积”的三明治结构；
* **时间卷积：** 使用带 GLU 门控机制的一维因果卷积捕捉时间依赖；
* **空间卷积：** 使用标准 GCN 模块在两个时间卷积之间建模空间依赖。

![STGCN结构](https://latex.codecogs.com/png.image?\dpi{120}v^{l+1}%20=%20\Gamma_1%20*_{\mathcal{T}}%20\mathrm{ReLU}\left\(\Theta%20*_{\mathcal{G}}%20\left\(\Gamma_0%20*_{\mathcal{T}}%20v^l\right\)\right\))

**优劣分析：**

* 简洁高效，训练易并行；
* 仅建模交通本身，难以融合外部因素；邻接矩阵固定，缺乏动态性。

---

## 3. ASTGCN (Guo et al., 2019)：引入注意力机制的精细建模

**核心思想：** 非所有历史时间与空间邻接都同等重要，模型应动态关注关键部分。

**结构设计：**

* **空间注意力：** 动态计算节点间权重：

![空间注意力](https://latex.codecogs.com/png.image?\dpi{120}S_{ij}%20=%20\frac{\exp\left\(\mathrm{LeakyReLU}\left\(W_1%20X_i^\top%20\cdot%20W_2%20X_j\right\)\right\)}{\sum_{k}\exp\left\(\mathrm{LeakyReLU}\left\(W_1%20X_i^\top%20\cdot%20W_2%20X_k\right\)\right\)})

* **时间注意力：** 类似机制对时间步进行加权；
* **周期建模：** 显式将输入分为近期、日周期、周周期三部分分别建模；
* **输出融合：**

![输出融合](https://latex.codecogs.com/png.image?\dpi{120}\hat{Y}%20=%20W_h%20\odot%20\hat{Y}_h%20+%20W_d%20\odot%20\hat{Y}_d%20+%20W_w%20\odot%20\hat{Y}_w)

**优劣分析：**

* 增强动态建模能力，体现周期性；
* 结构复杂，注意力计算较为耗时。

---

## 4. AST-GCN (Zhu et al., 2021)：属性增强的直接融合模型

**核心思想：** 将静态和动态外部信息拼接进输入特征序列，赋予每个节点“属性感知”能力。

**结构设计：**

* **静态属性** `S` ：如 POI、道路等级；
* **动态属性** `D^{t-m,t}` ：如天气、节假日等；
* **拼接方式：**

![属性拼接](https://latex.codecogs.com/png.image?\dpi{120}E^t%20=%20\left\[X^t,%20S,%20D_1^{t-m,t},%20D_2^{t-m,t},%20\dots\right])

* **后端建模：** GCN + GRU：

![后端建模](https://latex.codecogs.com/png.image?\dpi{120}h_t%20=%20\mathrm{GRU}\left\(\mathrm{GCN}\left\(E^t\right\),%20h_{t-1}\right\))

**优劣分析：**

* 简洁有效、易于实现，增强感知力；
* 对高维属性较敏感，易引入冗余。

---

## 5. STDF (Zhao et al., 2020)：异构数据融合的通用范式

**核心思想：** 拆分交通流与外部因子，分别建模后在中间层进行融合，实现模块化建模。

---

### 模型结构解析

STDF 结构如同一个“双流模型”，分别处理：

* **历史交通数据** `X_G^{t-P+1}, ..., X_G^t`：反映过去 `P` 个时间步在 `N` 个传感器节点的观测值（如车速、车流量）；
* **外部因素** `F_1^{(t)}, F_2^{(t)}, ..., F_n^{(t)}`：包括天气、节假日、大型事件等外生信息。

---

### 核心组件

#### 左侧主干流（主数据通道）

* 输入：历史交通数据张量 `X ∈ ℝ^{B × C × N × T}`
* 模块：多个 ST-Conv 块（时空卷积模块），采用 GCN+1D 时间卷积结构
* 作用：提取空间邻接性 + 时间动态性特征，输出为时空特征图 `FM_g`

#### 右侧辅助流（外部因素通道）

* 输入：多个外部特征源组成的序列张量 `F`

* 模块 1：**SETON（Spatial Embedding by Temporal convolutiON）**

  * 所有节点共享可学习的空间嵌入矩阵 `W_s`
  * 多因素共享时间卷积核 `W_t`
  * 高效提取外部因素的时空相关性 `FM_{st}`

* 模块 2：**Feature Transformer**

  * 将 `FM_{st}` 转换为与主干流特征一致的维度
  * 实现语义对齐与融合准备

#### 融合层（Intermediate Fusion）

通过逐元素融合操作整合两路特征：

![融合层](https://latex.codecogs.com/png.image?\dpi{120}FM_{fused}%20=%20\mathrm{ReLU}\left\(FM_g%20+%20\mathrm{Transformer}\left\(FM_{st}\right\)\right\))

融合后的特征保留了主干的时空建模能力，同时具备外部感知能力。

#### 输出层

将融合特征输入线性层，预测未来 `Q` 个时间步的交通状态：

![输出层](https://latex.codecogs.com/png.image?\dpi{120}\hat{Y}%20=%20f\left\(FM_{fused}\right\)%20\in%20\mathbb{R}^{B%20\times%20C'%20\times%20N%20\times%20Q})

---

### 参数共享策略与 SETON 设计理念

STDF 中引入了 **全局参数共享策略**，其核心为：

* 所有节点共享同一组空间嵌入参数 `W_s`，不再为每个节点单独设计；
* 时间卷积 `W_t` 在多个外部因素间共享，避免冗余建模；
* 类比于“用字母去索引单词”：SETON 就像一个通用查询引擎，为不同节点在外部语义空间中提供共享映射。

这大大提升了模型的参数效率与泛化能力，降低了外部特征的集成门槛。

---

### 优劣分析

| 优势              | 局限                |
| --------------- | ----------------- |
| 高度模块化，结构清晰      | 实现复杂，需精细化预处理与分流策略 |
| 参数共享机制，高效建模     | 对外部因素表示质量敏感       |
| 中间层融合更灵活、深度交互性强 | -                 |

---

STDF 就像一个字典，不仅能“看历史录像”（交通主干流），还能“看天气预报和日历”（外部辅助流），最终在大脑中融合这两类信息，输出更准确的预测结果。

## 6. 总结与展望：从静态建模到动态融合

| 模型      | 时间建模    | 空间建模    | 外部信息 | 动态性 | 优势             |
| ------- | ------- | ------- | ---- | --- | -------------- |
| STGCN   | CNN+GLU | 固定GCN   | ❌    | ❌   | 简洁高效，易于部署      |
| ASTGCN  | 注意力     | 注意力+GCN | 间接   | ✅   | 关键时间空间聚焦，周期性建模 |
| AST-GCN | GRU     | GCN     | 输入拼接 | 部分  | 简洁融合属性，扩展性强    |
| STDF    | 任意结构    | 任意GCN   | 中间融合 | ✅   | 模块化融合，参数高效     |

**发展趋势：**

* 从静态邻接矩阵 → 动态注意力矩阵；
* 从只依赖交通数据 → 多源信息融合；
* 从简单拼接 → 结构化编码与深度融合。

---

